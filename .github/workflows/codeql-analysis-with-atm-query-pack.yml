name: "CodeQL + ATM analysis"

on:
  workflow_dispatch:

jobs:
  CodeQL-Build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout repository
        uses: actions/checkout@v2

      - name: Initialize CodeQL
        id: codeql-init
        uses: github/codeql-action/init@v1
        with:
          tools: https://github.com/dsp-testing/codeql-cli-nightlies/releases/download/codeql-bundle-20211126/codeql-bundle-linux64.tar.gz
          languages: javascript
          db-location: '${{ github.workspace }}/codeql-database'

      - name: Extract CodeQL database
        uses: github/codeql-action/analyze@v1

      - name: Install ATM query pack
        env:
          CODEQL_PATH: ${{ steps.codeql-init.outputs.codeql-path }}
        run: |
          ${CODEQL_PATH} pack download codeql/javascript-experimental-atm-queries


